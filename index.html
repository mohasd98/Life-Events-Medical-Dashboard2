<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Birth Certificate Journey: Transformation</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React + ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    
    <script>window.react = window.React;</script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide-react@0.263.1/dist/umd/lucide-react.min.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f1f5f9; }
        
        .animate-fade-in { animation: fadeIn 0.5s ease-out forwards; }
        .animate-slide-up { animation: slideUp 0.5s ease-out forwards; }
        
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        
        /* UAE Pass Scan Animation */
        .scan-line {
            width: 100%;
            height: 2px;
            background: #22c55e;
            position: absolute;
            top: 0;
            left: 0;
            animation: scan 2s infinite linear;
            box-shadow: 0 0 4px #22c55e;
        }
        @keyframes scan { 0% { top: 0; } 50% { top: 100%; } 100% { top: 0; } }
        
        .metro-node { transition: all 0.3s ease; }
        .metro-line { transition: width 0.5s ease; }
    </style>
</head>
<body class="text-slate-900">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        const Lucide = window.LucideReact || new Proxy({}, { get: () => () => null });

        // --- COMPONENTS ---

        const Button = ({ children, onClick, variant = 'primary', className = '', disabled = false, icon: Icon }) => {
            const base = "px-6 py-3 rounded-xl font-semibold transition-all active:scale-95 flex items-center justify-center gap-2 shadow-sm";
            const styles = {
                primary: "bg-teal-700 text-white hover:bg-teal-800",
                secondary: "bg-white text-slate-700 hover:bg-slate-50 border border-slate-200",
                uae: "bg-slate-900 text-white hover:bg-slate-800",
                ghost: "bg-transparent text-teal-700 hover:bg-teal-50",
                danger: "bg-rose-50 text-rose-600 hover:bg-rose-100",
                black: "bg-black text-white hover:bg-gray-800"
            };
            return (
                <button 
                    onClick={onClick} 
                    disabled={disabled}
                    className={`${base} ${styles[variant]} ${disabled ? 'opacity-50 cursor-not-allowed' : ''} ${className}`}
                >
                    {Icon && <Icon className="w-5 h-5"/>} {children}
                </button>
            );
        };

        const Card = ({ children, className = '' }) => (
            <div className={`bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden ${className}`}>
                {children}
            </div>
        );

        // --- SCREEN 1: TAMM SPLASH ---
        const TammSplash = ({ onNext }) => {
            useEffect(() => {
                const timer = setTimeout(onNext, 2000);
                return () => clearTimeout(timer);
            }, []);

            return (
                <div className="h-screen flex flex-col items-center justify-center bg-gradient-to-br from-teal-900 to-teal-700 text-white relative overflow-hidden">
                    <div className="absolute inset-0 opacity-10 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')]"></div>
                    <div className="z-10 flex flex-col items-center animate-slide-up">
                        <div className="w-24 h-24 bg-white/10 rounded-3xl flex items-center justify-center backdrop-blur-md mb-6 border border-white/20 shadow-2xl">
                            <Lucide.Activity className="w-12 h-12 text-white" />
                        </div>
                        <h1 className="text-4xl font-bold tracking-tight">TAMM</h1>
                        <p className="text-teal-200 mt-2 text-sm tracking-widest uppercase">Abu Dhabi Government</p>
                    </div>
                    <div className="absolute bottom-10">
                        <Lucide.Loader2 className="w-6 h-6 animate-spin text-teal-300"/>
                    </div>
                </div>
            );
        };

        // --- SCREEN 2: UAE PASS LOGIN ---
        const UAEPassLogin = ({ onLogin }) => {
            const [isScanning, setIsScanning] = useState(false);

            const handleLogin = () => {
                setIsScanning(true);
                setTimeout(() => {
                    setIsScanning(false);
                    onLogin();
                }, 2000);
            };

            return (
                <div className="h-screen flex flex-col items-center justify-center bg-slate-50 p-6 relative">
                    <div className="absolute inset-0 bg-[radial-gradient(#e2e8f0_1px,transparent_1px)] [background-size:16px_16px] opacity-50"></div>

                    {isScanning ? (
                        <div className="z-10 flex flex-col items-center animate-fade-in">
                            <div className="w-32 h-32 bg-white rounded-3xl relative overflow-hidden shadow-2xl border-4 border-slate-900 flex items-center justify-center mb-8">
                                <Lucide.Fingerprint className="w-16 h-16 text-slate-800 opacity-20" />
                                <div className="scan-line"></div>
                            </div>
                            <h2 className="text-xl font-bold text-slate-900">Verifying Identity...</h2>
                            <p className="text-slate-500 mt-2">Please look at the camera</p>
                        </div>
                    ) : (
                        <div className="z-10 w-full max-w-sm">
                            <div className="text-center mb-12">
                                <h1 className="text-3xl font-bold text-slate-900 mb-2">Welcome Back</h1>
                                <p className="text-slate-500">Access your digital government services</p>
                            </div>
                            
                            <Card className="p-8 mb-6 border-slate-200 shadow-lg">
                                <div className="flex justify-center mb-6">
                                    <div className="w-16 h-16 bg-slate-900 rounded-2xl flex items-center justify-center text-white text-xs font-bold shadow-lg">
                                        UAE<br/>PASS
                                    </div>
                                </div>
                                <Button onClick={handleLogin} variant="uae" className="w-full h-14 text-lg shadow-xl" icon={Lucide.ScanFace}>
                                    Login with UAE Pass
                                </Button>
                            </Card>
                            
                            <p className="text-center text-xs text-slate-400">Secure & Trusted Identity</p>
                        </div>
                    )}
                </div>
            );
        };

        // --- SCREEN 3: LANDING / SPLIT ---
        const LandingPage = ({ onSelectMode = () => {} }) => {
            return (
                <div className="min-h-screen flex flex-col items-center justify-center p-6 bg-slate-50 relative">
                    <div className="absolute top-6 right-6 flex items-center gap-2">
                        <div className="w-8 h-8 rounded-full bg-slate-200 flex items-center justify-center border border-slate-300">
                            <Lucide.User className="w-4 h-4 text-slate-500"/>
                        </div>
                        <span className="text-sm font-bold text-slate-700">Omar Al Nuaimi</span>
                    </div>

                    <div className="max-w-5xl w-full z-10">
                        <div className="text-center mb-12">
                            <div className="inline-flex items-center gap-2 px-3 py-1 bg-teal-100 text-teal-800 rounded-full text-xs font-bold mb-4">
                                <Lucide.Sparkles className="w-3 h-3"/> Service Transformation
                            </div>
                            <h1 className="text-3xl md:text-4xl font-bold text-slate-900 mb-4">Issue Newborn Birth Certificate</h1>
                            <p className="text-slate-500 max-w-lg mx-auto">Experience the difference between the legacy process and the re-engineered digital journey.</p>
                        </div>
                        
                        <div className="grid md:grid-cols-2 gap-8">
                            {/* AS-IS BUTTON */}
                            <button 
                                onClick={() => onSelectMode('asis')}
                                className="group relative bg-white p-8 rounded-3xl border border-slate-200 hover:border-slate-300 shadow-sm hover:shadow-xl transition-all text-left duration-300 h-full flex flex-col"
                            >
                                <div className="absolute top-6 right-6">
                                    <span className="bg-slate-100 text-slate-500 text-[10px] font-bold px-2 py-1 rounded uppercase tracking-wider">Current State</span>
                                </div>
                                <div className="w-14 h-14 bg-slate-50 rounded-2xl flex items-center justify-center mb-6 group-hover:scale-110 transition-transform">
                                    <Lucide.History className="w-7 h-7 text-slate-400 group-hover:text-slate-600 transition-colors"/>
                                </div>
                                <h3 className="text-xl font-bold text-slate-900 mb-2">The "As-Is" Journey</h3>
                                <p className="text-sm text-slate-500 mb-6 leading-relaxed">High friction, multiple payment points, and manual data entry.</p>
                                
                                <div className="space-y-3 mt-auto">
                                     <div className="flex items-start gap-2 text-xs text-rose-700">
                                        <Lucide.XCircle className="w-4 h-4 shrink-0 mt-0.5"/> Confusing Notification Selection
                                    </div>
                                    <div className="flex items-start gap-2 text-xs text-rose-700">
                                        <Lucide.XCircle className="w-4 h-4 shrink-0 mt-0.5"/> Redundant Document Uploads
                                    </div>
                                    <div className="flex items-start gap-2 text-xs text-rose-700">
                                        <Lucide.XCircle className="w-4 h-4 shrink-0 mt-0.5"/> Separate Fees (Ar/En)
                                    </div>
                                     <div className="flex items-start gap-2 text-xs text-rose-700">
                                        <Lucide.XCircle className="w-4 h-4 shrink-0 mt-0.5"/> Manual Naming (Error Prone)
                                    </div>
                                    <div className="flex items-start gap-2 text-xs text-rose-700">
                                        <Lucide.XCircle className="w-4 h-4 shrink-0 mt-0.5"/> Manual Attestation (MOFA)
                                    </div>
                                </div>
                            </button>

                            {/* TO-BE BUTTON */}
                            <button 
                                onClick={() => onSelectMode('tobe')}
                                className="group relative bg-gradient-to-br from-teal-600 to-teal-800 p-8 rounded-3xl shadow-lg hover:shadow-2xl hover:scale-[1.02] transition-all text-left duration-300 h-full flex flex-col"
                            >
                                <div className="absolute top-6 right-6">
                                    <span className="bg-white/20 text-white text-[10px] font-bold px-2 py-1 rounded uppercase tracking-wider border border-white/30 backdrop-blur-md">Future State</span>
                                </div>
                                <div className="w-14 h-14 bg-white/20 rounded-2xl flex items-center justify-center mb-6 backdrop-blur-sm group-hover:bg-white/30 transition-colors">
                                    <Lucide.Zap className="w-7 h-7 text-white"/>
                                </div>
                                <h3 className="text-xl font-bold text-white mb-2">The "To-Be" Journey</h3>
                                <p className="text-teal-100 text-sm mb-6 leading-relaxed">Seamless, proactive, and error-free. Powered by AI and full backend integration.</p>
                                
                                <div className="space-y-3 mt-auto">
                                    <div className="flex items-start gap-2 text-xs text-white/90">
                                        <Lucide.CheckCircle2 className="w-4 h-4 shrink-0 text-teal-300 mt-0.5"/> Auto-Notification (Zero Input)
                                    </div>
                                    <div className="flex items-start gap-2 text-xs text-white/90">
                                        <Lucide.CheckCircle2 className="w-4 h-4 shrink-0 text-teal-300 mt-0.5"/> No Uploads (ICP Integration)
                                    </div>
                                    <div className="flex items-start gap-2 text-xs text-white/90">
                                        <Lucide.CheckCircle2 className="w-4 h-4 shrink-0 text-teal-300 mt-0.5"/> Instant Bundle (Cert + ID + Passport)
                                    </div>
                                     <div className="flex items-start gap-2 text-xs text-white/90">
                                        <Lucide.CheckCircle2 className="w-4 h-4 shrink-0 text-teal-300 mt-0.5"/> Smart Naming (ICP Verified)
                                    </div>
                                    <div className="flex items-start gap-2 text-xs text-white/90">
                                        <Lucide.CheckCircle2 className="w-4 h-4 shrink-0 text-teal-300 mt-0.5"/> Auto MOFA Attestation
                                    </div>
                                </div>
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        // --- AS-IS JOURNEY (Simulating Friction) ---
        const AsIsJourney = ({ onBack }) => {
            const [step, setStep] = useState(1);
            const [selectedNotif, setSelectedNotif] = useState("");
            const [langSelection, setLangSelection] = useState({ ar: false, en: false });
            const [rejectionVisible, setRejectionVisible] = useState(false);
            // Manual Name Inputs
            const [nameEn, setNameEn] = useState("");
            const [nameAr, setNameAr] = useState("");

            // 1. Confusing Dropdown
            if (step === 1) {
                return (
                    <div className="max-w-md mx-auto mt-10 animate-fade-in px-4">
                        <div className="mb-4">
                            <button onClick={onBack} className="text-xs text-slate-500 hover:text-slate-900 flex items-center gap-1"><Lucide.ArrowLeft className="w-3 h-3"/> Back</button>
                        </div>
                        <Card className="p-6">
                            <h2 className="text-lg font-bold mb-4">Step 1: Identification</h2>
                            <div className="space-y-4">
                                <div>
                                    <label className="block text-sm font-medium text-slate-700 mb-1">Select Notification Number</label>
                                    <select 
                                        className="w-full border border-slate-300 rounded-lg p-2.5 text-sm text-slate-600 bg-slate-50"
                                        value={selectedNotif}
                                        onChange={(e) => setSelectedNotif(e.target.value)}
                                    >
                                        <option value="" disabled>-- Select --</option>
                                        <option value="1293847192">1293847192</option>
                                        <option value="1293847193">1293847193</option> 
                                    </select>
                                    <p className="text-xs text-rose-500 mt-2 bg-rose-50 p-2 rounded border border-rose-100 flex gap-2">
                                        <Lucide.AlertCircle className="w-4 h-4 shrink-0"/> 
                                        Complaint #241: "I have twins. Which number corresponds to which baby? The list is unclear."
                                    </p>
                                </div>
                                <Button onClick={() => setStep(2)} disabled={!selectedNotif} className="w-full">Next</Button>
                            </div>
                        </Card>
                    </div>
                );
            }

            // 2. Document Uploads (Restored Friction)
            if (step === 2) {
                 return (
                    <div className="max-w-md mx-auto mt-10 animate-fade-in px-4">
                        <Card className="p-6">
                            <h2 className="text-lg font-bold mb-4">Step 2: Upload Documents</h2>
                            <div className="space-y-4">
                                <p className="text-sm text-slate-600">Please upload valid copies of the following documents:</p>
                                
                                {['Father Passport', 'Mother Passport', 'Marriage Contract', 'Family Book', 'Father EID', 'Mother EID'].map(doc => (
                                    <div key={doc} className="flex items-center justify-between p-3 border border-dashed border-slate-300 rounded-lg bg-slate-50">
                                        <span className="text-xs font-medium text-slate-700">{doc}</span>
                                        <button className="text-xs text-blue-600 font-bold hover:underline flex items-center gap-1"><Lucide.Upload className="w-3 h-3"/> Upload</button>
                                    </div>
                                ))}

                                <div className="bg-amber-50 p-3 rounded border border-amber-100 text-xs text-amber-800 flex gap-2">
                                    <Lucide.AlertTriangle className="w-4 h-4 shrink-0"/>
                                    Complaint #412: "Why do I have to re-upload these? ICP already has my data!"
                                </div>
                                <Button onClick={() => setStep(3)} className="w-full">Next</Button>
                            </div>
                        </Card>
                    </div>
                );
            }

            // 3. Manual Naming (The Error Source)
            if (step === 3) {
                return (
                    <div className="max-w-md mx-auto mt-10 animate-fade-in px-4">
                        <Card className="p-6">
                            <h2 className="text-lg font-bold mb-4">Step 3: Baby Details</h2>
                            <div className="space-y-4">
                                <div>
                                    <label className="block text-xs font-bold text-slate-500 mb-1 uppercase">Baby Name (English)</label>
                                    <input 
                                        type="text" 
                                        placeholder="Type Name..." 
                                        value={nameEn} 
                                        onChange={(e) => setNameEn(e.target.value)}
                                        className="w-full border border-slate-300 rounded p-2 text-sm text-slate-900 focus:ring-2 focus:ring-teal-500 outline-none" 
                                    />
                                </div>
                                <div>
                                    <label className="block text-xs font-bold text-slate-500 mb-1 uppercase">Baby Name (Arabic)</label>
                                    <input 
                                        type="text" 
                                        placeholder="أدخل الاسم..." 
                                        value={nameAr} 
                                        onChange={(e) => setNameAr(e.target.value)}
                                        className="w-full border border-slate-300 rounded p-2 text-sm text-slate-900 text-right focus:ring-2 focus:ring-teal-500 outline-none" 
                                    />
                                </div>
                                
                                {/* Added: Nationality Dropdown Error Simulation */}
                                <div>
                                    <label className="block text-xs font-bold text-slate-500 mb-1 uppercase">Nationality</label>
                                    <select className="w-full border border-slate-300 rounded p-2 text-sm text-slate-900">
                                        <option>United Arab Emirates</option>
                                    </select>
                                    <p className="text-[10px] text-rose-500 mt-1 hidden">Error: Input value doesn't match dropdown list.</p>
                                </div>

                                {/* Added: Religion Field */}
                                <div>
                                    <label className="block text-xs font-bold text-slate-500 mb-1 uppercase">Religion</label>
                                    <select className="w-full border border-slate-300 rounded p-2 text-sm text-slate-900">
                                        <option>Islam</option>
                                    </select>
                                </div>
                                
                                <div className="text-xs text-slate-400 italic">
                                    * Please ensure Arabic and English names match phonetically.
                                </div>
                                
                                <Button onClick={() => setStep(4)} disabled={!nameEn || !nameAr} className="w-full">Next</Button>
                            </div>
                        </Card>
                    </div>
                );
            }

            // 4. Language Selection (Extra Cost)
            if (step === 4) {
                 const cost = (langSelection.ar ? 50 : 0) + (langSelection.en ? 50 : 0);
                 return (
                    <div className="max-w-md mx-auto mt-10 animate-fade-in px-4">
                        <Card className="p-6">
                            <h2 className="text-lg font-bold mb-4">Step 4: Select Certificates</h2>
                            <p className="text-sm text-slate-600 mb-4">Please select the copies you require:</p>
                            
                            <div className="space-y-3 mb-6">
                                <label className={`flex items-center justify-between p-3 border rounded-lg cursor-pointer transition-all ${langSelection.ar ? 'border-teal-500 bg-teal-50' : 'hover:bg-slate-50'}`}>
                                    <div className="flex items-center gap-3">
                                        <input type="checkbox" checked={langSelection.ar} onChange={()=>setLangSelection({...langSelection, ar: !langSelection.ar})} className="w-4 h-4 text-teal-600" />
                                        <span className="text-sm font-medium">Arabic Certificate</span>
                                    </div>
                                    <span className="text-sm font-bold">50 AED</span>
                                </label>
                                <label className={`flex items-center justify-between p-3 border rounded-lg cursor-pointer transition-all ${langSelection.en ? 'border-teal-500 bg-teal-50' : 'hover:bg-slate-50'}`}>
                                    <div className="flex items-center gap-3">
                                        <input type="checkbox" checked={langSelection.en} onChange={()=>setLangSelection({...langSelection, en: !langSelection.en})} className="w-4 h-4 text-teal-600" />
                                        <span className="text-sm font-medium">English Certificate</span>
                                    </div>
                                    <span className="text-sm font-bold">50 AED</span>
                                </label>
                            </div>

                             <div className="border-t border-slate-200 pt-4 mb-4">
                                <div className="flex justify-between items-center">
                                    <span className="font-bold text-slate-900">Total</span>
                                    <span className="text-xl font-bold text-teal-700">{cost}.00 AED</span>
                                </div>
                            </div>

                            <Button onClick={() => setStep(5)} disabled={cost===0} className="w-full">Pay Now</Button>
                        </Card>
                    </div>
                );
            }

            // 5. Processing -> Rejection
            if (step === 5) {
                return (
                    <div className="max-w-md mx-auto mt-10 animate-fade-in px-4">
                        <Card className="p-8 text-center">
                            {!rejectionVisible ? (
                                <div className="animate-fade-in">
                                    <div className="w-16 h-16 bg-amber-100 rounded-full flex items-center justify-center mx-auto mb-4 animate-pulse">
                                        <Lucide.Clock className="w-8 h-8 text-amber-600"/>
                                    </div>
                                    <h2 className="text-xl font-bold text-slate-900 mb-2">Request Submitted</h2>
                                    <p className="text-sm text-slate-500 mb-6">Your application is under review. Please wait 2-3 working days for approval.</p>
                                    
                                    <Button onClick={() => setRejectionVisible(true)} variant="secondary" className="w-full border-dashed border-2">
                                        <Lucide.FastForward className="w-4 h-4"/> Simulate: 2 Days Later
                                    </Button>
                                </div>
                            ) : (
                                <div className="animate-fade-in">
                                    <div className="w-16 h-16 bg-rose-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                        <Lucide.XCircle className="w-8 h-8 text-rose-600"/>
                                    </div>
                                    <h2 className="text-xl font-bold text-slate-900 mb-2">Application Rejected</h2>
                                    
                                    <div className="bg-rose-50 p-4 rounded-xl border border-rose-200 text-left text-sm text-rose-800 mb-6">
                                        <div className="flex items-start gap-2 mb-2">
                                            <Lucide.AlertCircle className="w-4 h-4 shrink-0 mt-0.5"/>
                                            <strong>Reason:</strong>
                                        </div>
                                        <p>Name Mismatch. The Arabic name does not match the English spelling as per ICP naming rules.</p>
                                    </div>
                                    
                                    <div className="text-xs text-slate-500 mb-6">
                                        Please submit a new application with corrected names. Fees are non-refundable.
                                    </div>
                                    <Button onClick={onBack} variant="outline" className="w-full">Back to Home</Button>
                                </div>
                            )}
                        </Card>
                    </div>
                );
            }
        };

        // --- TO-BE JOURNEY (The Solution with Life Hub Features) ---
        const ToBeJourney = ({ onBack }) => {
            const [step, setStep] = useState(0); 
            const [nameEn, setNameEn] = useState("");
            const [nameAr, setNameAr] = useState("");
            const [aiSuggestions, setAiSuggestions] = useState([]);
            const [addMofa, setAddMofa] = useState(false);
            const [isProcessing, setIsProcessing] = useState(false);
            const [showPaymentRecovery, setShowPaymentRecovery] = useState(false);
            const [isRecovering, setIsRecovering] = useState(false);
            
            // Check if both fields have values for validation
            const isNameConfirmed = nameEn.length > 0 && nameAr.length > 0;

            // Metro Map Steps
            const steps = [
                { id: 1, label: "Notification" },
                { id: 2, label: "Naming" },
                { id: 3, label: "Docs" },
                { id: 4, label: "Bundle" },
                { id: 5, label: "Success" }
            ];

            // 0. Notification
            if (step === 0) {
                return (
                    <div className="h-screen flex flex-col items-center justify-center p-6 animate-fade-in relative bg-slate-100">
                        <div className="absolute top-10 left-0 w-full px-4">
                            <div 
                                onClick={() => setStep(1)}
                                className="bg-white/80 backdrop-blur-md p-4 rounded-2xl shadow-xl border border-white/50 cursor-pointer hover:scale-105 transition-transform animate-slide-up flex gap-4 items-start"
                            >
                                <div className="bg-teal-100 p-2 rounded-xl text-teal-700">
                                    <Lucide.Baby className="w-6 h-6" />
                                </div>
                                <div>
                                    <h4 className="font-bold text-sm text-slate-900">Mabrouk Ma Yak!</h4>
                                    <p className="text-xs text-slate-500 mt-1">Birth notification received for <strong>Baby Boy</strong>. Tap to name him & get documents.</p>
                                    <span className="text-[10px] text-slate-400 mt-2 block">Just now</span>
                                </div>
                            </div>
                        </div>
                        <p className="text-slate-400 text-sm mt-32">Simulating Phone Home Screen...</p>
                        <Button onClick={onBack} variant="ghost" className="absolute bottom-10">Exit Demo</Button>
                    </div>
                );
            }

            // Header for Steps
            const Header = () => (
                <div className="flex justify-between items-center mb-6 px-4">
                    {steps.map((s, i) => (
                        <div key={s.id} className="flex flex-col items-center gap-1 relative z-10">
                            <div className={`w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold transition-all ${step >= s.id ? 'bg-teal-600 text-white' : 'bg-slate-200 text-slate-500'}`}>
                                {step > s.id ? <Lucide.Check className="w-4 h-4"/> : s.id}
                            </div>
                            <span className="text-[10px] text-slate-500 font-medium">{s.label}</span>
                        </div>
                    ))}
                    <div className="absolute h-0.5 bg-slate-200 left-8 right-8 top-10 -z-0">
                        <div className="h-full bg-teal-600 transition-all duration-500" style={{width: `${((step-1)/(steps.length-1))*100}%`}}></div>
                    </div>
                </div>
            );

            // 1. Naming (Hybrid: Manual + AI + Validation)
            if (step === 1) {
                return (
                    <div className="max-w-md mx-auto mt-6 px-4 animate-fade-in pb-20">
                        <Header />
                        <Card className="p-6 mb-4">
                            <h2 className="text-xl font-bold mb-6">Name Your Baby</h2>
                            
                            <div className="space-y-6">
                                {/* Option A: Manual */}
                                <div className="space-y-3">
                                    <label className="block text-sm font-bold text-slate-700">Manual Entry</label>
                                    <div>
                                        <label className="block text-xs font-medium text-slate-500 mb-1">English Name</label>
                                        <input 
                                            type="text" 
                                            placeholder="e.g. Zayed" 
                                            className="w-full p-2 border border-slate-300 rounded-lg text-sm focus:ring-2 focus:ring-teal-500 outline-none"
                                            value={nameEn}
                                            onChange={(e) => setNameEn(e.target.value)}
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-xs font-medium text-slate-500 mb-1">Arabic Name</label>
                                        <input 
                                            type="text" 
                                            placeholder="e.g. زايد" 
                                            className="w-full p-2 border border-slate-300 rounded-lg text-sm text-right focus:ring-2 focus:ring-teal-500 outline-none"
                                            value={nameAr}
                                            onChange={(e) => setNameAr(e.target.value)}
                                        />
                                    </div>
                                </div>

                                <div className="relative flex py-2 items-center">
                                    <div className="flex-grow border-t border-slate-200"></div>
                                    <span className="flex-shrink-0 mx-4 text-xs text-slate-400">OR USE AI</span>
                                    <div className="flex-grow border-t border-slate-200"></div>
                                </div>

                                {/* Option B: AI */}
                                <div className="bg-purple-50 p-4 rounded-xl border border-purple-100">
                                    <div className="flex items-center gap-2 mb-3">
                                        <Lucide.Sparkles className="w-4 h-4 text-purple-600"/>
                                        <span className="text-xs font-bold text-purple-700">AI Suggestion</span>
                                    </div>
                                    <button 
                                        onClick={() => setAiSuggestions([
                                            {en: "Zayed", ar: "زايد"}, 
                                            {en: "Khalifa", ar: "خليفة"}, 
                                            {en: "Hamdan", ar: "حمدان"}
                                        ])}
                                        className="bg-white text-purple-700 border border-purple-200 px-3 py-2 rounded-lg text-xs font-bold hover:bg-purple-50 w-full"
                                    >
                                        Suggest Names
                                    </button>
                                    {aiSuggestions.length > 0 && (
                                        <div className="flex gap-2 mt-3 animate-fade-in flex-wrap">
                                            {aiSuggestions.map((suggestion, idx) => (
                                                <button 
                                                    key={idx}
                                                    onClick={() => { setNameEn(suggestion.en); setNameAr(suggestion.ar); }}
                                                    className="px-3 py-1 rounded-full text-xs font-medium border bg-white text-purple-700 border-purple-200 hover:bg-purple-50"
                                                >
                                                    {suggestion.en} / {suggestion.ar}
                                                </button>
                                            ))}
                                        </div>
                                    )}
                                </div>

                                {/* Validation Success Badge */}
                                {isNameConfirmed && (
                                    <div className="animate-slide-up">
                                        <div className="flex items-center gap-2 bg-green-50 text-green-800 p-3 rounded-xl border border-green-200 text-xs font-bold mb-4">
                                            <Lucide.ShieldCheck className="w-5 h-5 text-green-600"/>
                                            <div>
                                                <div className="text-sm">Verified Match</div>
                                                <div className="font-normal opacity-80">Arabic & English names match ICP rules.</div>
                                            </div>
                                        </div>
                                        <Button onClick={() => setStep(2)} className="w-full">Confirm Name: {nameEn}</Button>
                                    </div>
                                )}
                            </div>
                        </Card>
                    </div>
                );
            }

            // 2. Documents (Auto-Fetch)
            if (step === 2) {
                return (
                    <div className="max-w-md mx-auto mt-6 px-4 animate-fade-in pb-20">
                        <Header />
                        <Card className="p-6">
                            <h2 className="text-xl font-bold mb-6">Documents</h2>
                            <p className="text-sm text-slate-500 mb-4">We retrieved your official documents from ICP.</p>

                            <div className="space-y-3 mb-6">
                                <div className="flex items-center justify-between p-3 bg-white border border-slate-200 rounded-xl">
                                    <div className="flex items-center gap-3">
                                        <div className="bg-green-100 p-2 rounded-lg text-green-700"><Lucide.UserCheck className="w-5 h-5"/></div>
                                        <div>
                                            <div className="text-sm font-bold text-slate-900">Father's ID & Passport</div>
                                            <div className="text-[10px] text-slate-500">Fetched from ICP</div>
                                        </div>
                                    </div>
                                    <Lucide.Check className="w-5 h-5 text-green-600"/>
                                </div>
                                <div className="flex items-center justify-between p-3 bg-white border border-slate-200 rounded-xl">
                                    <div className="flex items-center gap-3">
                                        <div className="bg-green-100 p-2 rounded-lg text-green-700"><Lucide.UserCheck className="w-5 h-5"/></div>
                                        <div>
                                            <div className="text-sm font-bold text-slate-900">Mother's ID & Passport</div>
                                            <div className="text-[10px] text-slate-500">Fetched from ICP</div>
                                        </div>
                                    </div>
                                    <Lucide.Check className="w-5 h-5 text-green-600"/>
                                </div>
                                <div className="flex items-center justify-between p-3 bg-white border border-slate-200 rounded-xl">
                                    <div className="flex items-center gap-3">
                                        <div className="bg-green-100 p-2 rounded-lg text-green-700"><Lucide.FileCheck className="w-5 h-5"/></div>
                                        <div>
                                            <div className="text-sm font-bold text-slate-900">Marriage Contract</div>
                                            <div className="text-[10px] text-slate-500">Verified (Ministry of Justice)</div>
                                        </div>
                                    </div>
                                    <Lucide.Check className="w-5 h-5 text-green-600"/>
                                </div>
                            </div>
                            <Button onClick={() => setStep(3)} className="w-full">Proceed to Bundle</Button>
                        </Card>
                    </div>
                );
            }

            // 3. Bundle & Fees
            if (step === 3) {
                return (
                    <div className="max-w-md mx-auto mt-6 px-4 animate-fade-in pb-20">
                        <Header />
                        <Card className="p-6">
                            <h2 className="text-xl font-bold mb-2">Mabrouk Ma Yak</h2>
                            <p className="text-sm text-slate-500 mb-6">One bundle. All documents.</p>

                            <div className="bg-slate-50 p-4 rounded-xl border border-slate-200 mb-6">
                                <h4 className="text-xs font-bold text-slate-400 uppercase tracking-wider mb-3">Fee Breakdown</h4>
                                <div className="space-y-3">
                                    <div className="flex justify-between text-sm">
                                        <span className="text-slate-700">Birth Certificate</span>
                                        <span className="font-bold">50.00 AED</span>
                                    </div>
                                    <div className="flex justify-between text-sm">
                                        <span className="text-slate-700">Emirates ID (Newborn)</span>
                                        <span className="font-bold">170.00 AED</span>
                                    </div>
                                    <div className="flex justify-between text-sm">
                                        <span className="text-slate-700">Passport Issuance</span>
                                        <span className="font-bold">55.00 AED</span>
                                    </div>
                                </div>
                                <div className="border-t border-slate-200 my-3"></div>
                                <div className="flex justify-between items-center text-sm font-bold text-teal-800">
                                    <span>Bundle Total</span>
                                    <span>275.00 AED</span>
                                </div>
                            </div>

                            {/* Optional MOFA Add-on */}
                            <div 
                                onClick={() => setAddMofa(!addMofa)}
                                className={`p-4 rounded-xl border-2 cursor-pointer transition-all mb-6 flex items-start gap-3 ${addMofa ? 'border-teal-600 bg-teal-50' : 'border-slate-200 hover:border-teal-300'}`}
                            >
                                <div className={`w-5 h-5 rounded border flex items-center justify-center mt-0.5 ${addMofa ? 'bg-teal-600 border-teal-600' : 'border-slate-300 bg-white'}`}>
                                    {addMofa && <Lucide.Check className="w-3 h-3 text-white"/>}
                                </div>
                                <div>
                                    <div className="font-bold text-sm text-slate-900">Auto-Attest with MOFA</div>
                                    <p className="text-xs text-slate-500 mt-1">Digital attestation stamp from Ministry of Foreign Affairs.</p>
                                    <div className="text-xs font-bold text-teal-700 mt-1">+150.00 AED</div>
                                </div>
                            </div>

                            <Button onClick={() => setStep(4)} className="w-full">Continue to Payment</Button>
                        </Card>
                    </div>
                );
            }

            // 4. Payment
            if (step === 4) {
                const total = 275 + (addMofa ? 150 : 0);
                return (
                    <div className="max-w-md mx-auto mt-6 px-4 animate-fade-in pb-20">
                        <Header />
                        <Card className="p-6">
                            <h2 className="text-xl font-bold mb-6">Checkout</h2>
                            
                            <div className="flex justify-between items-center mb-6 p-4 bg-slate-900 text-white rounded-xl shadow-lg">
                                <span className="font-medium">Total Amount</span>
                                <span className="text-2xl font-bold">{total}.00 AED</span>
                            </div>

                            <div className="space-y-3 mb-6">
                                <div className="text-xs text-slate-500 uppercase tracking-wider font-bold">Summary</div>
                                <div className="flex justify-between text-xs text-slate-600">
                                    <span>Mabrouk Ma Yak Bundle</span>
                                    <span>275.00 AED</span>
                                </div>
                                {addMofa && (
                                    <div className="flex justify-between text-xs text-slate-600">
                                        <span>MOFA Attestation</span>
                                        <span>150.00 AED</span>
                                    </div>
                                )}
                            </div>

                            <Button onClick={() => setShowPaymentRecovery(true)} className="w-full mb-3" variant="black" icon={Lucide.Apple}>Pay with Apple Pay</Button>
                            
                            {/* Payment Recovery Logic */}
                            {showPaymentRecovery && (
                                <div className="animate-fade-in">
                                    {isRecovering ? (
                                        <div className="flex items-center justify-center gap-2 text-sm text-teal-600 font-medium py-2">
                                            <Lucide.Loader2 className="w-4 h-4 animate-spin"/> Verifying transaction...
                                        </div>
                                    ) : (
                                        <button 
                                            onClick={() => { setIsRecovering(true); setTimeout(() => setStep(5), 2000); }}
                                            className="w-full text-center text-xs text-blue-600 hover:text-blue-800 underline py-2"
                                        >
                                            I already paid, but status didn't update?
                                        </button>
                                    )}
                                </div>
                            )}
                        </Card>
                    </div>
                );
            }

            // 5. Success
            if (step === 5) {
                return (
                    <div className="max-w-md mx-auto mt-6 px-4 animate-fade-in pb-20 text-center">
                        <Header />
                        <Card className="p-8 relative overflow-hidden">
                            {/* Confetti */}
                            <div className="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-teal-400 to-blue-500"></div>
                            
                            <div className="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6 shadow-sm">
                                <Lucide.Check className="w-10 h-10 text-green-600"/>
                            </div>
                            <h2 className="text-2xl font-bold text-slate-900 mb-2">Mabrouk!</h2>
                            <p className="text-slate-500 text-sm mb-6">Zayed's documents are issued.</p>

                            {/* Health Score Boost */}
                            <div className="bg-emerald-50 border border-emerald-100 rounded-xl p-3 mb-6 flex items-center justify-center gap-2">
                                <Lucide.TrendingUp className="w-5 h-5 text-emerald-600"/>
                                <span className="text-sm font-bold text-emerald-800">Family Health Score: +15 Points!</span>
                            </div>

                            {/* Smart Wallet */}
                            <div className="bg-slate-50 p-4 rounded-xl border border-slate-200 mb-6 text-left">
                                <h4 className="text-xs font-bold text-slate-400 uppercase mb-3">Digital Locker</h4>
                                <div className="space-y-2">
                                    <div className="flex items-center justify-between bg-white p-2 rounded-lg border border-slate-200 shadow-sm cursor-pointer hover:border-teal-500 transition-colors">
                                        <div className="flex items-center gap-3">
                                            <Lucide.FileCheck className="w-5 h-5 text-teal-600"/>
                                            <span className="text-sm font-medium">Birth Certificate</span>
                                        </div>
                                        <Lucide.Download className="w-4 h-4 text-slate-400"/>
                                    </div>
                                    <div className="flex items-center justify-between bg-black text-white p-2 rounded-lg shadow-sm cursor-pointer hover:bg-gray-800 transition-colors">
                                        <div className="flex items-center gap-3">
                                            <Lucide.Wallet className="w-5 h-5"/>
                                            <span className="text-sm font-medium">Add to Apple Wallet</span>
                                        </div>
                                        <Lucide.Plus className="w-4 h-4"/>
                                    </div>
                                </div>
                            </div>

                            {/* Kiosk */}
                            <div className="bg-slate-900 text-white p-5 rounded-2xl text-left relative overflow-hidden group cursor-pointer shadow-xl transform transition-all hover:scale-105">
                                <div className="relative z-10">
                                    <div className="flex items-center gap-2 mb-2">
                                        <Lucide.Printer className="w-5 h-5 text-teal-400"/>
                                        <span className="font-bold text-lg">Hospital Kiosk Pickup</span>
                                    </div>
                                    <p className="text-xs text-slate-300 pr-8 leading-relaxed">
                                        Scan this code at the ICP Kiosk in the lobby to print the physical Passport & ID right now.
                                    </p>
                                </div>
                                <div className="mt-4 bg-white p-2 rounded-lg w-fit">
                                    <Lucide.QrCode className="w-16 h-16 text-slate-900"/>
                                </div>
                            </div>

                            <Button onClick={onBack} variant="secondary" className="w-full mt-6">Back to Home</Button>
                        </Card>
                    </div>
                );
            }
        };

        // --- MAIN APP COMPONENT ---
        const App = () => {
            const [view, setView] = useState('splash'); // splash -> login -> landing -> (asis/tobe)

            return (
                <div className="font-sans antialiased text-slate-900 bg-slate-50 min-h-screen">
                    {view === 'splash' && <TammSplash onNext={() => setView('login')} />}
                    {view === 'login' && <UAEPassLogin onLogin={() => setView('landing')} />}
                    {view === 'landing' && <LandingPage onSelectMode={(mode) => setView(mode)} />}
                    {view === 'asis' && <AsIsJourney onBack={() => setView('landing')} />}
                    {view === 'tobe' && <ToBeJourney onBack={() => setView('landing')} />}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById("root"));
        root.render(<App />);
    </script>
</body>
</html>
